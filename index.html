<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Motion Control Ball</title>
    <style>
        /* Basic CSS for a clean, full-screen layout */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        /* Canvas styling */
        canvas {
            background-color: #2c2c2c;
            display: block;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        /* Styling for the initial overlay and button */
        #start-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        #start-button {
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffffff;
            background: linear-gradient(145deg, #007aff, #005bb5);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 122, 255, 0.4);
            transition: all 0.3s ease;
        }
        #start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 122, 255, 0.6);
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        p {
            font-size: 1rem;
            max-width: 80%;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>

    <!-- This screen asks for permission before starting the game -->
    <div id="start-screen">
        <h1>Motion Ball</h1>
        <p>Tilt your device to roll the ball on the plate. Press Start to enable motion sensors.</p>
        <button id="start-button">Start</button>
    </div>

    <!-- The canvas is where the game is drawn -->
    <canvas id="gameCanvas"></canvas>

    <script>
        // --- DOM ELEMENTS ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('start-screen');
        const startButton = document.getElementById('start-button');

        // --- GAME & PHYSICS VARIABLES ---
        let plate, ball;
        // These will store the acceleration values from the sensor
        let accelX = 0;
        let accelY = 0;
        const FRICTION = 0.985; // Slightly increased friction for better control
        const SENSITIVITY = 0.4; // Sensitivity multiplier for acceleration

        // --- SETUP FUNCTIONS ---

        /**
         * Resizes the canvas to fit the window while maintaining a good aspect ratio.
         */
        function resizeCanvas() {
            const size = Math.min(window.innerWidth, window.innerHeight) * 0.9;
            canvas.width = size;
            canvas.height = size;

            // Re-initialize game objects with new dimensions
            plate = {
                x: canvas.width / 2,
                y: canvas.height / 2,
                radius: canvas.width / 2 * 0.95
            };
            if (!ball) { // Only set initial position once
                ball = {
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    radius: canvas.width / 20,
                    vx: 0, // velocity x
                    vy: 0  // velocity y
                };
            }
        }

        /**
         * Requests permission to access device motion sensors using the DeviceMotionEvent API.
         */
        function requestMotionPermission() {
            // Check for the modern permission API, common on iOS 13+
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('devicemotion', handleMotion);
                            startGame();
                        } else {
                            alert('Permission to use motion sensors was denied.');
                        }
                    })
                    .catch((error) => {
                        console.error(error);
                        alert('Could not get permission for motion sensors.');
                    });
            } else {
                // For Android and other devices that don't require explicit permission via this API
                window.addEventListener('devicemotion', handleMotion);
                startGame();
            }
        }

        /**
         * Hides the start screen and begins the animation loop.
         */
        function startGame() {
            startScreen.style.display = 'none';
            gameLoop();
        }
        
        // --- EVENT HANDLERS ---

        /**
         * Captures the device's acceleration data.
         * @param {DeviceMotionEvent} event - The motion data.
         */
        function handleMotion(event) {
            // Using accelerationIncludingGravity to get the direction of gravity's pull
            const { x, y } = event.accelerationIncludingGravity;
            
            // The x and y from the sensor correspond to the phone's axes.
            // We map them to our canvas coordinates.
            accelX = x * SENSITIVITY;
            accelY = y * SENSITIVITY;
        }
        
        // Add event listeners
        window.addEventListener('resize', resizeCanvas);
        startButton.addEventListener('click', requestMotionPermission);


        // --- GAME LOOP & DRAWING ---

        /**
         * The main animation loop. Updates physics and redraws the canvas.
         */
        function gameLoop() {
            // --- 1. UPDATE PHYSICS ---
            
            // Update velocity based on acceleration.
            // The 'y' from the sensor often corresponds to the vertical tilt,
            // but we negate it because a positive 'y' acceleration should move the ball "down" (positive y in canvas).
            ball.vx += accelX;
            ball.vy -= accelY; // Note the subtraction here to correct the axis direction
            
            // Apply friction to slow the ball down
            ball.vx *= FRICTION;
            ball.vy *= FRICTION;

            // Update position based on velocity
            ball.x += ball.vx;
            ball.y += ball.vy;

            // --- 2. HANDLE COLLISIONS ---
            const distFromCenter = Math.sqrt(Math.pow(ball.x - plate.x, 2) + Math.pow(ball.y - plate.y, 2));

            if (distFromCenter > plate.radius - ball.radius) {
                // Ball is at or beyond the edge of the plate
                const angle = Math.atan2(ball.y - plate.y, ball.x - plate.x);
                
                // Reposition the ball to be exactly on the edge
                ball.x = plate.x + Math.cos(angle) * (plate.radius - ball.radius);
                ball.y = plate.y + Math.sin(angle) * (plate.radius - ball.radius);

                // Simulate a bounce by reflecting the velocity vector
                const dot = ball.vx * Math.cos(angle) + ball.vy * Math.sin(angle);
                ball.vx -= 1.5 * dot * Math.cos(angle); // 1.5 gives a little bounce
                ball.vy -= 1.5 * dot * Math.sin(angle);
            }

            // --- 3. DRAW EVERYTHING ---
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw the plate
            ctx.beginPath();
            ctx.arc(plate.x, plate.y, plate.radius, 0, Math.PI * 2);
            ctx.fillStyle = '#4a4a4a';
            ctx.fill();
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 4;
            ctx.stroke();

            // Draw the ball with a lighting effect
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            const ballGradient = ctx.createRadialGradient(ball.x - ball.radius/3, ball.y - ball.radius/3, ball.radius/4, ball.x, ball.y, ball.radius);
            ballGradient.addColorStop(0, '#ff8a80');
            ballGradient.addColorStop(1, '#d32f2f');
            ctx.fillStyle = ballGradient;
            ctx.fill();
            ctx.strokeStyle = '#b71c1c';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Request the next frame
            requestAnimationFrame(gameLoop);
        }

        // --- INITIALIZE ---
        resizeCanvas();

    </script>
</body>
</html>
